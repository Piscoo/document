<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lissajous</title>
  <style>
    #main {
      width: 600px;
      margin: 100px auto;
    }
  </style>
</head>
<body>
  <div id="main" data-width="512">
    <canvas></canvas>
  </div>
  <div id="controller"></div>
  <script>
    (function() {
      const size = +document.querySelector('#main').dataset.width
      const canvas = document.querySelector('canvas')
      canvas.width = size * 2;
      canvas.height = size
      const ctx = canvas.getContext('2d')
      ctx.translate(size / 2, size / 2)
      ctx.strokeStyle = '#7ed'
      ctx.lineCap = 'round'
      const {
        sin,
        sqrt,
        random,
        PI,
      } = Math
      const A = size / 2 - 1

      class Lissajous {
        k = 1.66;
        fade = false;
        constructor() {
          this.setup()
          this.draw()
        }
        setup = () => {
          delete this.lastP
          ctx.clearRect(-size / 2, -size / 2, size, size)
          this._k = this.k
          this.delta = 0.05 / sqrt(this._k)
          this.phi = random() * 2 * PI
          this.theta = 0
        };
        draw = () => {
          if (this.fade) {
            ctx.fade()
          }
          const p = [
            sin(this.theta) * A,
            sin(this._k * this.theta + this.phi) * A
          ]
          ctx.beginPath()
          ctx.moveTo(...(this.lastP || p))
          ctx.lineTo(...p)
          ctx.stroke()

          this.lastP = p
          this.theta += this.delta
          requestAnimationFrame(this.draw)
        };
      }

      const lis = new Lissajous()
      const gui = new dat.GUI({ autoPlace: false })
      document.getElementById('controller').appendChild(gui.domElement)
      gui.add(lis, 'k', 0.25, 4).step(0.01).onFinishChange(lis.setup)
      gui.add(lis, 'fade')
    })()
  </script>
</body>
</html>